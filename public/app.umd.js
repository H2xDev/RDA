!function(t){"function"==typeof define&&define.amd?define(t):t()}(function(){function t(){return t=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},t.apply(this,arguments)}function e(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,n(t,e)}function n(t,e){return n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},n(t,e)}var i,o=/*#__PURE__*/function(){function e(){this.events={}}var n=e.prototype;return n.on=function(t,e,n){var i=this;void 0===n&&(n={}),this.isEventTypeDefined(t)||this.defineEventType(t);var o={handler:e,options:n,event:t};return this.events[t].push(o),function(){return i.removeListener(t,o.handler)}},n.once=function(){var e=[].slice.call(arguments);return e[2]=e[2]?t({},e[2],{once:!0}):{once:!0},this.on.apply(this,e)},n.trigger=function(t,e){var n=this;this.isEventTypeDefined(t)&&(this.events[t].forEach(function(t){t.handler.bind(n)(e)}),this.events[t].forEach(this.checkEventListener.bind(this)))},n.checkEventListener=function(t){var e=t.event;t.options.once&&this.removeListener(e,t.handler),"number"==typeof t.options.takes&&(t.options.takes-=1,0===t.options.takes&&this.removeListener(e,t.handler))},n.removeListener=function(t,e){this.events[t]=this.events[t].filter(function(t){return t.handler!==e}),this.events[t].length||delete this.events[t]},n.isEventTypeDefined=function(t){return!!this.events[t]},n.defineEventType=function(t){this.events[t]=[]},e}(),r=/*#__PURE__*/function(n){function i(t){var e;return(e=n.call(this)||this).domElement=document.createElement("canvas"),e.context=void 0,e.options=void 0,e.setOptions(t||{}),e}e(i,n);var o=i.prototype;return o.setOptions=function(e){this.options=t({},i.DEFAULT_OPTIONS,e),this.applyOptions()},o.render=function(t){var e=this;this.clear(),requestAnimationFrame(function(){return e.render(t)}),this.trigger("beforeRender"),t(),this.trigger("afterRender")},o.clear=function(){var t=this.context;t.fillStyle="#000",t.fillRect(0,0,t.canvas.width,t.canvas.height)},o.applyOptions=function(){var t=this.options.resolution,e=t[1],n=this.options,i=n.pixelated,o=n.targetContainer;this.domElement.width=t[0],this.domElement.height=e,this.context=this.domElement.getContext("2d",{alpha:!1}),this.context.imageSmoothingEnabled=!i,this.domElement.style.imageRendering=i?"pixelated":"",document.querySelector(o).appendChild(this.domElement)},i}(o);r.DEFAULT_OPTIONS={resolution:[800,480],pixelated:!0,targetContainer:"body"},function(t){t[t.SPAWN=0]="SPAWN",t[t.DESTROY=1]="DESTROY"}(i||(i={}));var s,a=/*#__PURE__*/function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))||this).scene=void 0,e.position={x:0,y:0},e}e(n,t);var i=n.prototype;return i.update=function(){},i.setScene=function(t){this.scene=t},n}(o);!function(t){t[t.LOAD=0]="LOAD",t[t.DESTROY=1]="DESTROY"}(s||(s={}));var c=/*#__PURE__*/function(t){function n(){var e;return(e=t.call(this)||this).entities={},e.on(s.LOAD,function(){return e.start()}),e.on(s.DESTROY,function(){return e.destroy()}),e}e(n,t);var o=n.prototype;return o.addEntity=function(t,e){var n;return void 0===e&&(n=1e4*Math.random()>>0,e=(Date.now()+n).toString(35)),this.entities[e]=t,t.setScene(this),t.trigger(i.SPAWN),t},o.updateObjects=function(){Object.values(this.entities).forEach(function(t){return null==t.update?void 0:t.update()})},o.update=function(){this.updateObjects()},o.start=function(){},o.destroy=function(){this.entities={}},n}(o),u=new(/*#__PURE__*/function(){function t(){this.currentScene=void 0,this.update=this.update.bind(this)}var e=t.prototype;return e.update=function(){this.currentScene&&this.currentScene.update()},e.load=function(t){this.destroyScene(),this.setScene(t),this.currentScene.trigger(s.LOAD)},e.destroyScene=function(){this.currentScene&&this.currentScene.trigger(s.DESTROY)},e.setScene=function(t){this.currentScene=t},t}()),h=new r,l=h.context,p=/*#__PURE__*/function(t){function n(e){var n;return(n=t.call(this)||this).context=void 0,n.resolution=[1,1],n.originalResolution=[1,1],n.position={x:0,y:0},n.rotation=0,n.zoom=1,n.entityToFollow=void 0,n.followSmoothness=16,n.sceneUpdate=void 0,n.context=e,n.once(i.SPAWN,function(){n.applyResolution(),n.overwriteRendering()}),n}e(n,t);var o,r=n.prototype;return r.overwriteRendering=function(){this.sceneUpdate=this.scene.update.bind(this.scene),this.scene.update=this.update.bind(this)},r.applyResolution=function(){var t=this.context;this.resolution=[t.canvas.width,t.canvas.height],this.originalResolution=[t.canvas.width,t.canvas.height]},r.moveCameraToTarget=function(){if(this.entityToFollow){var t=this.entityToFollow.position,e=t.y;this.position.x-=(this.position.x-t.x)/this.followSmoothness,this.position.y-=(this.position.y-e)/this.followSmoothness}},r.update=function(){var t=this.context;this.sceneUpdate&&(this.moveCameraToTarget(),t.save(),this.applyCameraTransform(),this.sceneUpdate(),t.restore())},r.applyCameraTransform=function(){var t=this.context;t.translate(this.resolution[0]/2,this.resolution[1]/2),t.rotate(this.rotation/180*Math.PI),t.scale.apply(t,this.actualZoom),t.translate(-this.position.x,-this.position.y)},(o=[{key:"actualZoom",get:function(){return this.resolution?[this.originalResolution[0]/(this.resolution[0]/this.zoom),this.originalResolution[1]/(this.resolution[1]/this.zoom)]:[1,1]}}])&&function(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}(n.prototype,o),n}(a),f=/*#__PURE__*/function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))||this).camera=new p(l),e}e(n,t);var i=n.prototype;return i.start=function(){this.addEntity(this.camera)},i.update=function(){},n}(c),d=new f;u.load(d),h.render(u.update)});
//# sourceMappingURL=app.umd.js.map
